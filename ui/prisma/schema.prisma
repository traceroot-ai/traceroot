generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model api_keys {
  id           String    @id @db.VarChar
  project_id   String    @db.VarChar
  key_hash     String    @unique @db.VarChar
  key_prefix   String    @db.VarChar
  name         String?   @db.VarChar
  expires_at   DateTime? @db.Timestamp(6)
  last_used_at DateTime? @db.Timestamp(6)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  projects     projects  @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([project_id], map: "ix_api_key_project_id")
}

model membership_invitations {
  id                 String        @id @db.VarChar
  email              String        @db.VarChar
  org_id             String        @db.VarChar
  org_role           String        @db.VarChar
  invited_by_user_id String?       @db.VarChar
  created_at         DateTime      @default(now()) @db.Timestamp(6)
  updated_at         DateTime      @default(now()) @db.Timestamp(6)
  users              users?        @relation(fields: [invited_by_user_id], references: [id], onUpdate: NoAction)
  organizations      organizations @relation(fields: [org_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([email, org_id], map: "uq_invitation_email_org")
  @@index([org_id], map: "ix_invitation_org_id")
}

model organization_memberships {
  id            String        @id @db.VarChar
  org_id        String        @db.VarChar
  user_id       String        @db.VarChar
  role          String        @db.VarChar
  created_at    DateTime      @default(now()) @db.Timestamp(6)
  updated_at    DateTime      @default(now()) @db.Timestamp(6)
  organizations organizations @relation(fields: [org_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([org_id, user_id], map: "uq_org_user")
  @@index([org_id], map: "ix_membership_org_id")
  @@index([user_id], map: "ix_membership_user_id")
}

model organizations {
  id                       String                     @id @db.VarChar
  name                     String                     @db.VarChar
  created_at               DateTime                   @default(now()) @db.Timestamp(6)
  updated_at               DateTime                   @default(now()) @db.Timestamp(6)
  membership_invitations   membership_invitations[]
  organization_memberships organization_memberships[]
  projects                 projects[]
}

model projects {
  id             String        @id @db.VarChar
  org_id         String        @db.VarChar
  name           String        @db.VarChar
  retention_days Int?
  deleted_at     DateTime?     @db.Timestamp(6)
  created_at     DateTime      @default(now()) @db.Timestamp(6)
  updated_at     DateTime      @default(now()) @db.Timestamp(6)
  api_keys       api_keys[]
  organizations  organizations @relation(fields: [org_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([org_id], map: "ix_project_org_id")
}

model users {
  id                       String                     @id @db.VarChar
  email                    String?                    @unique @db.VarChar
  name                     String?                    @db.VarChar
  password                 String?                    @db.VarChar
  image                    String?                    @db.VarChar
  admin                    Boolean
  created_at               DateTime                   @default(now()) @db.Timestamp(6)
  updated_at               DateTime                   @default(now()) @db.Timestamp(6)
  membership_invitations   membership_invitations[]
  organization_memberships organization_memberships[]
  accounts accounts[]
}

model accounts {                                                                                                                                                                                                                        
    id                String  @id @default(cuid())                                                                                                                                                                                       
    userId            String  @map("user_id")                                                                                                                                                                                            
    type              String                                                                                                                                                                                                             
    provider          String                                                                                                                                                                                                             
    providerAccountId String  @map("provider_account_id")                                                                                                                                                                                
    refresh_token     String? @db.Text                                                                                                                                                                                                   
    access_token      String? @db.Text                                                                                                                                                                                                   
    expires_at        Int?                                                                                                                                                                                                               
    token_type        String?                                                                                                                                                                                                            
    scope             String?                                                                                                                                                                                                            
    id_token          String? @db.Text                                                                                                                                                                                                   
    session_state     String?                                                                                                                                                                                                            
    createdAt         DateTime @default(now()) @map("created_at")                                                                                                                                                                        
    updatedAt         DateTime @updatedAt @map("updated_at")                                                                                                                                                                             
                                                                                                                                                                                                                                         
    user users @relation(fields: [userId], references: [id], onDelete: Cascade)                                                                                                                                                           
                                                                                                                                                                                                                                         
    @@unique([provider, providerAccountId])                                                                                                                                                                                              
}                                                   
